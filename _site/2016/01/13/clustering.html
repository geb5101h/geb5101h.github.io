<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Clustering | Eric Janofsky</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Clustering" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Clustering is one of the fundamental tasks in unsupervised learning, but there are a huge diversity of approaches. There is k-means , mean-shift, hierarchical clustering, mixture models and more. The reason for so many varied approaches is that clustering by itself is ill-defined. In this post I will focus on two methods, mean-shift and Gaussian mixture modeling, because they have a more “statistical” flavor, in that they can be related to modeling a probability distribution over the data. Despite their similarities, they are based on sometimes contradictory principles. 1. Mean-shift Mean-shift clusters points by the modes of a nonparametric kernel density. The kernel density estimator for data \(x_1,\ldots,x_N\) is \(\hat{p}(x) =\frac{1}{nh^d} \sum_{i=1}^NK(\frac{\Vert x-x_i\Vert^2}{h}),\) where \(K\) is a kernel function. You can imagine the kernel to be some density with variance one, such as a Gaussian density, with variability controlled by the bandwidth \(h\). In effect a kernel density is a smoothed histogram, a mixture of local densities at each datum. \(\hat{p}\) has some number of modes, let’s say \(p \).  The gradient of the density at a point \(x\) looks like \( \nabla \hat{p}(x) = L(x)\cdot\left( \frac{ \sum_{i=1}^N x_i k(\frac{\Vert x-x_i\Vert^2}{h})}{\sum_{i=1}^n k(\frac{\Vert x-x_i\Vert^2}{h})} - x \right), \) where \(L(x)\) is a positive function, \(k=K’\) and the second term is called the mean-shift, which we denote \(m(x)\). Any mode of \(\hat{p}\) will satisfy the fixed point \(m(x)=0\). Mean-shift works as follows. Initialize \(w_1\) at some point. Then iterate the following until convergence: \(w_t \leftarrow w_{t-1} + m(w_{t-1}).\) Each iteration moves the point in an ascent direction of the density. Eventually it will converge to a fixed point, which is one of the modes of \(\hat{p}\). We do this for each data point, and we assign clusters based on which fixed point it converged to. It’s well known that the kernel density is a consistent estimate of the true density for large sample size (and further, it’s modes are consistent as well). But there’s not a lot of understanding on guarantees for mean-shift itself. Also, density estimation is sensitive to bandwidth, and the number of modes can change for different choices of \(h\). 2. Mixture Models Mixture models cluster based on a most probable assignment to a mixture component. It provides a generative interpretation for the data. It can do “soft clustering”, which means it provides not just the most probable cluster assignment, but the full probability vector (known as the responsibilities) for a datum belonging to all the clusters. In addition to clustering you also get a predictive density at no extra cost." />
<meta property="og:description" content="Clustering is one of the fundamental tasks in unsupervised learning, but there are a huge diversity of approaches. There is k-means , mean-shift, hierarchical clustering, mixture models and more. The reason for so many varied approaches is that clustering by itself is ill-defined. In this post I will focus on two methods, mean-shift and Gaussian mixture modeling, because they have a more “statistical” flavor, in that they can be related to modeling a probability distribution over the data. Despite their similarities, they are based on sometimes contradictory principles. 1. Mean-shift Mean-shift clusters points by the modes of a nonparametric kernel density. The kernel density estimator for data \(x_1,\ldots,x_N\) is \(\hat{p}(x) =\frac{1}{nh^d} \sum_{i=1}^NK(\frac{\Vert x-x_i\Vert^2}{h}),\) where \(K\) is a kernel function. You can imagine the kernel to be some density with variance one, such as a Gaussian density, with variability controlled by the bandwidth \(h\). In effect a kernel density is a smoothed histogram, a mixture of local densities at each datum. \(\hat{p}\) has some number of modes, let’s say \(p \).  The gradient of the density at a point \(x\) looks like \( \nabla \hat{p}(x) = L(x)\cdot\left( \frac{ \sum_{i=1}^N x_i k(\frac{\Vert x-x_i\Vert^2}{h})}{\sum_{i=1}^n k(\frac{\Vert x-x_i\Vert^2}{h})} - x \right), \) where \(L(x)\) is a positive function, \(k=K’\) and the second term is called the mean-shift, which we denote \(m(x)\). Any mode of \(\hat{p}\) will satisfy the fixed point \(m(x)=0\). Mean-shift works as follows. Initialize \(w_1\) at some point. Then iterate the following until convergence: \(w_t \leftarrow w_{t-1} + m(w_{t-1}).\) Each iteration moves the point in an ascent direction of the density. Eventually it will converge to a fixed point, which is one of the modes of \(\hat{p}\). We do this for each data point, and we assign clusters based on which fixed point it converged to. It’s well known that the kernel density is a consistent estimate of the true density for large sample size (and further, it’s modes are consistent as well). But there’s not a lot of understanding on guarantees for mean-shift itself. Also, density estimation is sensitive to bandwidth, and the number of modes can change for different choices of \(h\). 2. Mixture Models Mixture models cluster based on a most probable assignment to a mixture component. It provides a generative interpretation for the data. It can do “soft clustering”, which means it provides not just the most probable cluster assignment, but the full probability vector (known as the responsibilities) for a datum belonging to all the clusters. In addition to clustering you also get a predictive density at no extra cost." />
<link rel="canonical" href="http://localhost:4000/2016/01/13/clustering.html" />
<meta property="og:url" content="http://localhost:4000/2016/01/13/clustering.html" />
<meta property="og:site_name" content="Eric Janofsky" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-01-13T22:22:33-05:00" />
<script type="application/ld+json">
{"description":"Clustering is one of the fundamental tasks in unsupervised learning, but there are a huge diversity of approaches. There is k-means , mean-shift, hierarchical clustering, mixture models and more. The reason for so many varied approaches is that clustering by itself is ill-defined. In this post I will focus on two methods, mean-shift and Gaussian mixture modeling, because they have a more “statistical” flavor, in that they can be related to modeling a probability distribution over the data. Despite their similarities, they are based on sometimes contradictory principles. 1. Mean-shift Mean-shift clusters points by the modes of a nonparametric kernel density. The kernel density estimator for data \\(x_1,\\ldots,x_N\\) is \\(\\hat{p}(x) =\\frac{1}{nh^d} \\sum_{i=1}^NK(\\frac{\\Vert x-x_i\\Vert^2}{h}),\\) where \\(K\\) is a kernel function. You can imagine the kernel to be some density with variance one, such as a Gaussian density, with variability controlled by the bandwidth \\(h\\). In effect a kernel density is a smoothed histogram, a mixture of local densities at each datum. \\(\\hat{p}\\) has some number of modes, let’s say \\(p \\).  The gradient of the density at a point \\(x\\) looks like \\( \\nabla \\hat{p}(x) = L(x)\\cdot\\left( \\frac{ \\sum_{i=1}^N x_i k(\\frac{\\Vert x-x_i\\Vert^2}{h})}{\\sum_{i=1}^n k(\\frac{\\Vert x-x_i\\Vert^2}{h})} - x \\right), \\) where \\(L(x)\\) is a positive function, \\(k=K’\\) and the second term is called the mean-shift, which we denote \\(m(x)\\). Any mode of \\(\\hat{p}\\) will satisfy the fixed point \\(m(x)=0\\). Mean-shift works as follows. Initialize \\(w_1\\) at some point. Then iterate the following until convergence: \\(w_t \\leftarrow w_{t-1} + m(w_{t-1}).\\) Each iteration moves the point in an ascent direction of the density. Eventually it will converge to a fixed point, which is one of the modes of \\(\\hat{p}\\). We do this for each data point, and we assign clusters based on which fixed point it converged to. It’s well known that the kernel density is a consistent estimate of the true density for large sample size (and further, it’s modes are consistent as well). But there’s not a lot of understanding on guarantees for mean-shift itself. Also, density estimation is sensitive to bandwidth, and the number of modes can change for different choices of \\(h\\). 2. Mixture Models Mixture models cluster based on a most probable assignment to a mixture component. It provides a generative interpretation for the data. It can do “soft clustering”, which means it provides not just the most probable cluster assignment, but the full probability vector (known as the responsibilities) for a datum belonging to all the clusters. In addition to clustering you also get a predictive density at no extra cost.","datePublished":"2016-01-13T22:22:33-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2016/01/13/clustering.html"},"url":"http://localhost:4000/2016/01/13/clustering.html","headline":"Clustering","dateModified":"2016-01-13T22:22:33-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Eric Janofsky" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Eric Janofsky</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Clustering is one of the fundamental tasks in unsupervised learning, but there are a huge diversity of approaches. There is <a href="https://en.wikipedia.org/wiki/K-means_clustering">k-means</a> , <a href="https://en.wikipedia.org/wiki/Mean_shift">mean-shift</a>,<a href="https://en.wikipedia.org/wiki/Hierarchical_clustering"> hierarchical clustering</a>,<a href="https://en.wikipedia.org/wiki/Mixture_model"> mixture models</a> and more. The reason for so many varied approaches is that clustering by itself is ill-defined. In this post I will focus on two methods, mean-shift and Gaussian mixture modeling, because they have a more “statistical” flavor, in that they can be related to modeling a probability distribution over the data. Despite their similarities, they are based on sometimes contradictory principles.</p><p><b>1. Mean-shift</b></p><p>Mean-shift clusters points by the modes of a <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation">nonparametric kernel density</a>. The kernel density estimator for data \(x_1,\ldots,x_N\) is</p><p>\(\hat{p}(x) =\frac{1}{nh^d} \sum_{i=1}^NK(\frac{\Vert x-x_i\Vert^2}{h}),\)</p><p>where \(K\) is a kernel function. You can imagine the kernel to be some density with variance one, such as a Gaussian density, with variability controlled by the bandwidth \(h\). In effect a kernel density is a smoothed histogram, a mixture of local densities at each datum. \(\hat{p}\) has some number of modes, let’s say \(p \). </p><p>The gradient of the density at a point \(x\) looks like</p><p>\( \nabla \hat{p}(x) = L(x)\cdot\left( \frac{ \sum_{i=1}^N x_i k(\frac{\Vert x-x_i\Vert^2}{h})}{\sum_{i=1}^n k(\frac{\Vert x-x_i\Vert^2}{h})} - x \right), \)</p><p>where \(L(x)\) is a positive function, \(k=K’\) and the second term is called the mean-shift, which we denote \(m(x)\). Any mode of \(\hat{p}\) will satisfy the fixed point \(m(x)=0\).</p><p>Mean-shift works as follows. Initialize \(w_1\) at some point. Then iterate the following until convergence:</p><p>\(w_t \leftarrow w_{t-1} + m(w_{t-1}).\)</p><p>Each iteration moves the point in an ascent direction of the density. Eventually it will converge to a fixed point, which is one of the modes of \(\hat{p}\). We do this for each data point, and we assign clusters based on which fixed point it converged to.</p><p>It’s well known that the kernel density is a consistent estimate of the true density for large sample size (and further, it’s modes are consistent as well). But there’s not a lot of understanding on guarantees for mean-shift itself. Also, density estimation is sensitive to bandwidth, and the number of modes can change for different choices of \(h\).</p><!-- more --><p><b>2. Mixture Models</b></p><p>Mixture models cluster based on a most probable assignment to a mixture component. It provides a generative interpretation for the data. It can do “soft clustering”, which means it provides not just the most probable cluster assignment, but the full probability vector (known as the responsibilities) for a datum belonging to all the clusters. In addition to clustering you also get a predictive density at no extra cost.</p>

<p>We may think of a Gaussian mixture model as a latent variable model. Suppose we have a random vector \(Y \sim Multinomial(1,p)\), that is \(Y\) chooses one value of \(\{1,\ldots,D\}\) according to probabilities \(p_1,\ldots,p_D\). Furthermore, for \(j\in \{1,\ldots,D\}\), we suppose \(Z_j \sim Normal(\mu_j,\Sigma_j)\), with each \(Z\) mutually independent and independent of \(Y\).  A random vector \(X\) is a Gaussian mixture when we write it as.</p><p>\( X = \sum_{j=1}^D Y_j Z_j .\)</p><p>The density for a D-component GMM is given by</p>

<p>\(p(x \mid \{\theta_j, \mu_j,\Sigma_j\}_{j=1}^D ) = \sum_{j=1}^D \theta_j N(x \mid \mu_j,\Sigma_j), \)</p>

<p>where \(N(x \mid \mu,\Sigma)\) is a normal density. We maximize the log-likelihood:</p>

<p>\( \max_{\left\{\{\theta_j, \mu_j,\Sigma_j\}_{j=1}^D\right\}} \sum_{i=1}^N \log 

p(x \mid \theta, \{\mu_j,\Sigma_j\}_{j=1}^D ) 

. \)</p>

<p>This can be treated as a standard smooth optimization and use any solver of choice, but it’s more common to use the EM-algorithm.<br/></p><p>The optimization of a GMM has some peculiar characteristics. Firstly, the likelihood has singularities. Suppose one of the clusters has a mean equal to one of the data. As the variance of the cluster goes to zero (so that one of the clusters becomes a point mass at the datum), the overall likelihood becomes unbounded. In such cases we say the maximum likelihood does not exist, but in practice we can often get a good solution which corresponds to some local optimum if we start at a reasonable initialization. Another phenomenon with mixture models is the “label switching” problem: there are always D! equivalent solutions corresponding to permutations of the parameter values among the clusters.</p><p>For a Gaussian mixture model, the number of modes of the density may be more or less than the number of clusters [1]. Also, the modes will generally not agree with the component means. Mixture modeling and mean-shift are really solutions to two different clustering objectives.</p><figure data-orig-width="662" data-orig-height="397" class="tmblr-full"><img src="https://66.media.tumblr.com/98e837eb472077587e3ceb60adc6cff5/tumblr_inline_o0x85dEJ5v1tlyjch_540.png" alt="image" data-orig-width="662" data-orig-height="397"/></figure><p>

Figure 1: Left: a two-component mixture with one mode; Right: a two-component mixture with three modes.

<br/></p><p>We still have the issue of selecting the number of clusters. This  is similar to choosing the bandwidth in mean-shift. Increasing D will always increase the log-likelihood objective, so you must select using a penalized score like BIC. However, BIC is designed to find a “good” model in the sense of density estimation. This is not necessarily the same as a “good” clustering, which we explained earlier is not well defined.</p><p>There are several good implementations of GMM, such as <a href="http://www.stat.washington.edu/mclust/">mclust</a> in R. There is also an <a href="http://spark.apache.org/docs/latest/mllib-clustering.html#gaussian-mixture">implementation</a> for distributed data in Apache Spark MLLIB.</p><p><b>3. Demo</b></p><p>To demonstrate I fit the Gaussian mixture model in mclust to the <a href="http://www.stat.cmu.edu/~larry/all-of-statistics/=data/faithful.dat">faithful</a> data set, a classic set of measurements of eruption/waiting time pairs at Old Faithful. mclust compares various types of models (spherical, elliptical, equal or different variances, etc.). Here BIC chooses 3 ellipsoidal Gaussian components. Two components are close together, resulting in many points having a high degree of classification uncertainty. </p><figure data-orig-width="762" data-orig-height="551" class="tmblr-full"><img src="https://66.media.tumblr.com/71c8cd03585fa4817c5a23c75bd41431/tumblr_inline_o0x92a2VeH1tlyjch_540.png" alt="image" data-orig-width="762" data-orig-height="551"/></figure><p>Figure 2: GMM Clustering on faithful data set</p><p>Next I try mean-shift using the R package LCPM. Using the bandwidth chosen by something called “self-coverage”. We see the algorithm converges to two modes.</p><figure data-orig-width="859" data-orig-height="574" class="tmblr-full"><img src="https://66.media.tumblr.com/aad695b30f0e17c0d598be0cd24d008d/tumblr_inline_o107vc5SjK1tlyjch_540.png" alt="image" data-orig-width="859" data-orig-height="574"/></figure><p>Figure 3: Mean-shift gradient curves for faithful data set.</p><p>Both of these methods give results that look a little funny. It may be surprising that GMM chose three clusters instead of two. Mean-shift chooses two clusters, but a few of the cluster assignments look surprising. One interesting property of mean-shift is a data point need not be assigned to the closest cluster center (according to some distance), because a mode may have a very large basin of attraction in the density. The cluster center is also not the literal “center” of the data in that cluster.  GMM has three clusters but with a lot of classification uncertainty between two of them, while mean-shift classifies some points to the larger cluster which GMM assigned very little uncertainty of being in the smaller cluster! Also observe that the GMM density, despite having three mixture components, only has two modes. We should appreciate that these methods are really approaching clustering with two possibly incompatible philosophies.</p><p>I hope this shows the challenges in clustering even for the simplest of datasets. </p><p>There are some Bayesian treatments of Gaussian mixtures that I really like, which overcome several of the limitations of the aforementioned approach. I am working on a project to implement them in <a href="https://github.com/geb5101h/BayesGaussianMixture">Spark</a>. I will do a separate post on the details</p>

<p>[1]:<a href="http://faculty2.ucmerced.edu/mcarreira-perpinan/papers/sst03.pdf">On the Number of Modes of a Gaussian Mixture</a></p>

  </div><a class="u-url" href="/2016/01/13/clustering.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Eric Janofsky</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Eric Janofsky</li><li><a class="u-email" href="mailto:ebjanofsky@gmail.com">ebjanofsky@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/geb5101h"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">geb5101h</span></a></li><li><a href="https://www.twitter.com/geb5101h"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">geb5101h</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
